
WITH qt AS
(
  SELECT uri, chunk_num, SIMILARITY('al 69 9m 99 ii ae f4 dq fl i3 1o 5h bi k9 da 35 81 cl ig 75 dn a5 df 7a b2 a1 6a fr 42 j6 gm 8j 95 kt aa 9h 36 hn 8u 34 kj 61 7r 56 8o 1u fs in 50 ib fk 8z ge as iv jw bf 9c jl 7b 62 cj 70 cc', token)::NUMERIC(4, 3) sim, token, chunk, svec
  FROM text_embed@text_embed_token_idx
  WHERE 'al 69 9m 99 ii ae f4 dq fl i3 1o 5h bi k9 da 35 81 cl ig 75 dn a5 df 7a b2 a1 6a fr 42 j6 gm 8j 95 kt aa 9h 36 hn 8u 34 kj 61 7r 56 8o 1u fs in 50 ib fk 8z ge as iv jw bf 9c jl 7b 62 cj 70 cc' % token
  ORDER BY sim DESC
  LIMIT 5
), q1 AS
(
  SELECT score_row('{"al": -0.24144502492880202, "69": 0.1806748700786206, "9m": 0.17270473921836246, "99": -0.1633165929673081, "ii": 0.15319282473771945, "ae": -0.14584530492297174, "f4": -0.14399071241447184, "dq": -0.14323729141352687, "fl": -0.14294393124296295, "i3": 0.14113028446763193, "1o": -0.14034335838115264, "5h": -0.14006485290044315, "bi": -0.13661030830719864, "k9": -0.13288606462549862, "da": -0.131604934093152, "35": -0.13117326124021814, "81": -0.13103500176867755, "cl": 0.12782176828644137, "ig": 0.12659053177506252, "75": -0.12640168654177286, "dn": 0.12475388018451812, "a5": 0.12426223872693017, "df": 0.12413220919699249, "7a": 0.12253145894980795, "b2": 0.12217406841461778, "a1": -0.1212726237549503, "6a": 0.12107042260349901, "fr": 0.12104301015792288, "42": -0.12102181451090671, "j6": -0.12077046429009826, "gm": 0.12073881271511888, "8j": -0.1201487400917433, "95": -0.11912204600830623, "kt": 0.11891629746823298, "aa": -0.11682936874193828, "9h": 0.11668528268458613, "36": -0.11664105561694194, "hn": -0.11651765083525575, "8u": -0.11573041435227205, "34": 0.11396341573731969, "kj": 0.11391282997557066, "61": -0.11332413196528607, "7r": -0.11179500349437875, "56": 0.11156328806959281, "8o": 0.11105041549110246, "1u": 0.11039318193264175, "fs": -0.10824240907962347, "in": -0.10702357069147835, "50": -0.10653285155493208, "ib": -0.10602738415019007, "fk": -0.1050377602778524, "8z": -0.10451922961451005, "ge": 0.10429114139459005, "as": -0.10391610260100567, "iv": -0.10207760636837787, "jw": -0.10090998340346218, "bf": -0.10075509554775618, "9c": -0.09906132390243248, "jl": -0.09873098220548471, "7b": -0.09857986345018953, "62": 0.09851320801798304, "cj": -0.0983449819810585, "70": 0.09705722670046038, "cc": -0.0962760385150771}'::jsonb, svec) score, *
  FROM qt
)
SELECT *
FROM q1
ORDER BY q1.score DESC;

